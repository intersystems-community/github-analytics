<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="GitHub.RepositoriesLoader">
<Super>GitHub.OrganizationPage</Super>
<TimeCreated>63909,16899.230917</TimeCreated>

<Method name="Load">
<Description>
Load repositories of organization</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>page</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[	Quit ##class(GitHub.RepositoriesLoader).Scan( page )
]]></Implementation>
</Method>

<Method name="Scan">
<Description>
Scan across all organization's pages</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>page</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	set sc = 1, i = 1 

	set pages = page.Pages() Quit:pages=0 $$$ERROR($$$GeneralError,"Can't parse pages count ") 
	
	while i <= pages {
		
		set sc = page.Parse() Quit:'sc
		write !, "Page of repositories #", i, " successfuly loaded", !
		set i = i + 1, sc = page.Get( , i ) ;load next page #i in parser  
		Quit:'sc 
		}
	Quit sc
]]></Implementation>
</Method>

<Method name="OnRepository">
<Description><![CDATA[
Event handler 
<var>data</var> - key-value array with repository properties 
If handler return 0, parsing will be interrupted]]></Description>
<FormalSpec><![CDATA[&data]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	Quit:'##class(GitHub.Organization).NameExists( ..Organization, .organizationId ) 0
	set data("Organization") = organizationId
	set data("Link") = "https://github.com/"_..Organization_"/"_$get(data("Name"))
	
	set sc = ##class(GitHub.Repository).Insert( .data ) 

	write $get(data), " " ;output repository id
	
	Quit sc
]]></Implementation>
</Method>
</Class>
</Export>
