<?xml version="1.0" encoding="UTF-8"?>
<Export generator="Cache" version="25">
<Class name="GitHub.OrganizationLoader">
<Super>GitHub.RepositoriesLoader</Super>
<TimeCreated>63909,21330.155873</TimeCreated>

<Method name="Load">
<Description>
Entry point</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec>organization="intersystems-ru",login="",password=""</FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if login'=""{
		set sc = ##class(GitHub.Login).CreateLoggedSession(login,password,.session) Q:'sc
		}
	else{set session = ""}
	
	write !,"Load Organization's properties",!
	,"And general properties of Organization's Repositories... ",!,!
	set sc = ##class(GitHub.OrganizationLoader).Scan( organization, .session ) 
	if 'sc write sc Quit sc
	
	write !,"Detail load Organization's Repositories ... "
	set sc = ##class(GitHub.RepositoryDetailsLoader).Load( organization, .session ) 
	if 'sc write sc Quit sc
	
	Quit sc
]]></Implementation>
</Method>

<Method name="Scan">
<Description>
Scan across one organization's page</Description>
<ClassMethod>1</ClassMethod>
<FormalSpec><![CDATA[organization="intersystems-ru",&session]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	
	set page = ##class(GitHub.OrganizationLoader).GetPage( organization, 1, .sc, .session ) Quit:'sc sc
	
	set sc = page.ParseOrganization() Quit:'sc
	
	Quit ##class(GitHub.RepositoriesLoader).Load( page )
]]></Implementation>
</Method>

<Method name="OnOrganization">
<Description><![CDATA[
Event handler 
<var>data</var> - key-value array with organization properties 
If handler return 0, parsing will be interrupted]]></Description>
<FormalSpec><![CDATA[&data]]></FormalSpec>
<ReturnType>%Status</ReturnType>
<Implementation><![CDATA[
	if ##class(GitHub.Organization).NameExists( ..Organization, .id ){
		do ##class(GitHub.Organization).%DeleteId(id)
		}
	
	set data("Name") = ..Organization
	set data("FullName") = $get(data("FullName"))
	set data("Description") = $get(data("Description"))
	set data("OrgLink") = $get(data("OrgLink"))
	set data("eMail") = $get(data("eMail"))
	set data("People") = $get(data("People"))
	

	set sc = ##class(GitHub.Organization).Insert( .data ) 

	write ..Organization_" successfuly loaded - id "_$get(data),!,!
	
	Quit sc
]]></Implementation>
</Method>
</Class>
</Export>
